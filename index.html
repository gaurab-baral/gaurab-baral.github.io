<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- An ID for the viewport meta so we can reset mobile zoom -->
  <meta id="viewportMeta" name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Shipping Label Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
    }

    form {
      margin-top: 20px;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }

    /* Button styling to feel more responsive */
    button {
      background: #4CAF50;
      color: #fff;
      border: none;
      cursor: pointer;
      margin-bottom: 5px;

      /* Smooth transitions for hover/click effects */
      transition: transform 0.15s ease, background-color 0.2s ease;
    }

    button:hover {
      transform: scale(1.02);
      background: #45a049;
    }

    button:active {
      transform: scale(0.97);
      background: #449a48;
    }

    #preview {
      margin-top: 30px;
    }

    .label-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }

    .remove-btn {
      background: #f44336;
      color: #fff;
      border: none;
      cursor: pointer;
      padding: 6px 12px;
      margin-top: 10px;
    }

    .remove-btn:hover {
      background: #e53935;
    }
  </style>
</head>
<body>
  <h1>Shipping Label Generator</h1>

  <!-- Form for adding a label -->
  <form id="shippingForm">
    <label for="fromField">From:</label>
    <input type="text" id="fromField" required />

    <label for="toField">To:</label>
    <input type="text" id="toField" required />

    <label for="addressField">Address:</label>
    <input type="text" id="addressField" required />

    <label for="cityField">City:</label>
    <input type="text" id="cityField" required />

    <label for="stateField">State:</label>
    <input type="text" id="stateField" required />

    <label for="zipField">Zip Code:</label>
    <input type="text" id="zipField" required />

    <button type="submit">Add Shipping Label</button>
  </form>

  <!-- Download button (hidden until labels exist) -->
  <button id="downloadPdfBtn" style="display: none;">Download PDF</button>

  <!-- Preview container -->
  <div id="preview"></div>

  <!-- Load jsPDF (no integrity attribute) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Inline JS -->
  <script>
    let labels = [];

    const shippingForm = document.getElementById('shippingForm');
    const fromField = document.getElementById('fromField');
    const toField = document.getElementById('toField');
    const addressField = document.getElementById('addressField');
    const cityField = document.getElementById('cityField');
    const stateField = document.getElementById('stateField');
    const zipField = document.getElementById('zipField');

    const previewDiv = document.getElementById('preview');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');

    // Force mobile view to reset (zoom out) after submission
    function forceMobileReset() {
      const metaTag = document.getElementById('viewportMeta');
      // Temporarily set maximum-scale=1.0 to force a zoom-out
      metaTag.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0');

      // After a short delay, remove the maximum-scale restriction
      setTimeout(() => {
        metaTag.setAttribute('content', 'width=device-width, initial-scale=1.0');
      }, 300);
    }

    shippingForm.addEventListener('submit', (e) => {
      e.preventDefault();

      // Grab each field individually
      const fromValue = fromField.value.trim();
      const toValue = toField.value.trim();
      const addressValue = addressField.value.trim();
      const cityValue = cityField.value.trim();
      const stateValue = stateField.value.trim();
      const zipValue = zipField.value.trim();

      // Create a label object (store separately)
      const newLabel = {
        from: fromValue,
        to: toValue,
        address: addressValue,
        city: cityValue,
        state: stateValue,
        zip: zipValue
      };

      // Add to array
      labels.push(newLabel);
      renderPreview();

      // Clear fields
      shippingForm.reset();

      // Close keyboard on mobile
      document.activeElement.blur();

      // Force mobile view back to default
      forceMobileReset();

      // Show "Download PDF" if there's at least one label
      if (labels.length > 0) {
        downloadPdfBtn.style.display = 'inline-block';
      }
    });

    function renderPreview() {
      previewDiv.innerHTML = '';

      // For each label, we show Address on one line, then City/State/Zip on the next
      labels.forEach((label, index) => {
        const labelDiv = document.createElement('div');
        labelDiv.classList.add('label-item');

        // City, State, Zip all in one line: "City, State ZipCode"
        const cityStateZip = `${label.city}, ${label.state} ${label.zip}`;

        labelDiv.innerHTML = `
          <p><strong>From:</strong> ${label.from}</p>
          <p><strong>To:</strong> ${label.to}</p>
          <p><strong>Address:</strong> ${label.address}</p>
          <p><strong>City/State/Zip:</strong> ${cityStateZip}</p>

          <button class="remove-btn" data-index="${index}">Remove</button>
        `;
        previewDiv.appendChild(labelDiv);
      });

      // Attach remove handlers
      document.querySelectorAll('.remove-btn').forEach((btn) => {
        btn.addEventListener('click', removeLabel);
      });
    }

    function removeLabel(e) {
      const index = e.target.dataset.index;
      labels.splice(index, 1);
      renderPreview();

      // Hide PDF button if no labels left
      if (labels.length === 0) {
        downloadPdfBtn.style.display = 'none';
      }
    }

    downloadPdfBtn.addEventListener('click', () => {
      if (!window.jspdf) {
        alert('Error: jsPDF did not load.');
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont('times', 'normal');
      doc.setFontSize(12);

      const pageHeight = doc.internal.pageSize.getHeight();
      let yPos = 10;

      // Loop each label, printing line by line
      labels.forEach((label) => {
        // "From" line
        if (yPos + 7 > pageHeight) {
          doc.addPage();
          yPos = 10;
        }
        doc.text(`From: ${label.from}`, 10, yPos);
        yPos += 7;

        // "To" line
        if (yPos + 7 > pageHeight) {
          doc.addPage();
          yPos = 10;
        }
        doc.text(`To: ${label.to}`, 10, yPos);
        yPos += 7;

        // "Address" line
        if (yPos + 7 > pageHeight) {
          doc.addPage();
          yPos = 10;
        }
        doc.text(`Address: ${label.address}`, 10, yPos);
        yPos += 7;

        // City/State/Zip line
        const cityStateZip = `${label.city}, ${label.state} ${label.zip}`;

        if (yPos + 7 > pageHeight) {
          doc.addPage();
          yPos = 10;
        }
        doc.text(`City/State/Zip: ${cityStateZip}`, 10, yPos);
        yPos += 15; // blank space before next label
      });

      doc.save('shipping-labels.pdf');
    });
  </script>
</body>
</html>
