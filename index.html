<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shipping Label Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
    }
    form {
      margin-top: 20px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      margin-bottom: 5px;
    }
    button:hover {
      background: #45a049;
    }
    #preview {
      margin-top: 30px;
    }
    .label-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>Shipping Label Generator</h1>

  <!-- Form for adding a label -->
  <form id="shippingForm">
    <label for="fromField">From:</label>
    <input type="text" id="fromField" required />

    <label for="toField">To:</label>
    <input type="text" id="toField" required />

    <label for="addressField">Address:</label>
    <input type="text" id="addressField" required />

    <label for="cityField">City:</label>
    <input type="text" id="cityField" required />

    <label for="stateField">State:</label>
    <input type="text" id="stateField" required />

    <label for="zipField">Zip Code:</label>
    <input type="text" id="zipField" required />

    <button type="submit">Add Shipping Label</button>
  </form>

  <!-- Download button (hidden until labels exist) -->
  <button id="downloadPdfBtn" style="display: none;">Download PDF</button>

  <!-- Preview container -->
  <div id="preview"></div>

  <!-- Load jsPDF WITHOUT integrity attribute -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Inline JS so there's no mismatch -->
  <script>
    // Store all shipping labels in this array
    const labels = [];

    // Get references to DOM elements
    const shippingForm = document.getElementById('shippingForm');
    const fromField = document.getElementById('fromField');
    const toField = document.getElementById('toField');
    const addressField = document.getElementById('addressField');
    const cityField = document.getElementById('cityField');
    const stateField = document.getElementById('stateField');
    const zipField = document.getElementById('zipField');

    const previewDiv = document.getElementById('preview');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');

    // On form submit
    shippingForm.addEventListener('submit', (e) => {
      e.preventDefault();

      // Build the single address string
      const fromValue = fromField.value.trim();
      const toValue = toField.value.trim();
      const addressValue = addressField.value.trim();
      const cityValue = cityField.value.trim();
      const stateValue = stateField.value.trim();
      const zipValue = zipField.value.trim();
      
      // Concatenate into one field
      const fullAddress = `${addressValue}, ${cityValue}, ${stateValue} ${zipValue}`;

      // Create a label object
      const newLabel = {
        from: fromValue,
        to: toValue,
        address: fullAddress
      };

      // Push to labels array
      labels.push(newLabel);

      // Update the preview
      renderPreview();

      // Clear fields
      shippingForm.reset();

      // Show "Download PDF" if there's at least 1 label
      if (labels.length > 0) {
        downloadPdfBtn.style.display = 'inline-block';
      }
    });

    // Renders the preview below the form
    function renderPreview() {
      previewDiv.innerHTML = '';

      labels.forEach(label => {
        const labelDiv = document.createElement('div');
        labelDiv.classList.add('label-item');
        // No "Label #", just the shipping details
        labelDiv.innerHTML = `
          <p><strong>From:</strong> ${label.from}</p>
          <p><strong>To:</strong> ${label.to}</p>
          <p><strong>Address:</strong> ${label.address}</p>
        `;
        previewDiv.appendChild(labelDiv);
      });
    }

    // Generate PDF with all labels in Times 12pt, same page
    downloadPdfBtn.addEventListener('click', () => {
      if (!window.jspdf) {
        alert('Error: jsPDF did not load.');
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Use Times, normal style, 12pt
      doc.setFont('times', 'normal');
      doc.setFontSize(12);

      let yPos = 10;
      // No doc.addPage() calls -> same page
      labels.forEach(label => {
        doc.text(`From: ${label.from}`, 10, yPos);   yPos += 7;
        doc.text(`To: ${label.to}`, 10, yPos);       yPos += 7;
        doc.text(`Address: ${label.address}`, 10, yPos);
        yPos += 15; // Blank line before next label
      });

      doc.save('shipping-labels.pdf');
    });
  </script>
</body>
</html>
